# MSA(Micro Service Architecture) 란?
> 기존 Monolithic Architecture 과 다르게 application 간 느슨하게 결합하는 소프트웨어 개발 기법이다.

## Monolithic Architecture 가 뭐야?
```text
하나의 application 에 모든 기능을 가지고 있는 통합 소프트웨어 개발 기법이다.
일반적으로 레거시 시스템 혹은 규모가 작은 소프트웨어들은 이 방식을 택하고 있다.
```

## 그럼 application 간 느슨하게 결합하는 소프트웨어 개발 기법 이 무슨 말이야?

MSA 개발 기법을 이야기 하기전에, MSA 와 Monolithic 를 비교하기 쉽게,
Monolithic Architecture 상황으로 가정해보자.

```text
맥도날드(Monolithic)의 평소 방문자 수는 100명이다. 오늘은 신규 햄버거를 판매하는 날이다.    
이 소식을 듣고, 10000명의 손님들이 몰려 주문을 하기 위해 총 3대의 키오스크에 몰려 들었고,   
급기야 키오스크가 마비가 되었다. 그래서 맥도날드 매니저는 급하게 수리 기사를 불러, 키오스크를 고쳤다.   
근데 이젠 주방이 과부하가 걸려, 마비가 되었다. 키오스크는 정상이 되었지만,  
주방이 마비가 되어 대기 손님은 늘어나는데, 햄버거는 나오지 않는다.   
맥도날드 매니저는 이렇게 연쇄적인 상황으로 맥도날드는 오늘 장사를 포기하고 접었다.    
```

### 느슨한 소프트웨어 개발 기법과 맥도날드가 무슨 상관인데?
느슨한 맥도날드(MSA) 였다면 어땠을까??  

```text
맥도날드의 평소 방문자 수는 100명이다. 오늘은 신규 햄버거를 판매하는 날이다.    
이 소식을 듣고, 10000명의 손님들이 몰려 주문을 하기 위해 총 3대의 키오스크에 몰려 들었고,        
급기야 키오스크가 마비가 되었다. 맥도날드의 키오스크 매니저는 당황하지 않고,   
옆에 키오스크 가게에서 재빨리 키오스크를 10대를 더 사왔다. 그랬더니 간신히 폭주하는 손님들의 주문을 받을 수 있었다.   
그런데 이젠 주방이 말썽이다. 주방이 과부하가 걸리기 시작하니, 주방 매니저가 더 이상 주문을 받을 수 없다고,   
키오스크 매니저에게 말한다. 키오스크 매니저는 손님들에게 현재 주문량이 너무 많아, 잠시 주문을 중단하겠다고   
손님들에게 양해를 구한다. 그리고 주방 매니저가 다시 주문을 받을 준비가 되었다고, 말을 하고   
주문 접수를 정상적으로 재개하며, 성공적인 장사를 마칠수 있었다.    
```

여기서 느슨한 맥도날드와 그렇지 않은 맥도날드의 차이점을 알아보자.
1. 손님이 늘어나자, 키오스크를 추가 구비 했다.  
2. 주방이 지연되자, 주문 접수를 일시 중단했다.     
3. 주방이 지연 된 상태에서, 접수된 손님들의 햄버거는 모두 제공되었다.

자, 이 말을 application 관점에서 이야기 해보자면   
1. 접속 폭주로 인해 server scale out 을 하여 대처 했다.
   - 키오스크 가게에서 재빨리 키오스크를 10대를 더 사왔다.
2. circuit breaker 적용을 하여, 연쇄적인 장애 전파를 차단했다.
   - 주방 매니저가 더 이상 주문을 받을 수 없다고, 키오스크 매니저에게 말한다.
3. 각 서비스가 자신의 일을 할 수 있도록 보호 받을 수 있다.
   - 주문 접수를 정상적으로 재개 
   - 주방 매니저가 다시 주문을 받을 준비
   - 접수된 손님들의 햄버거는 모두 제공되었다.
   - 풀어서 이야기 해보자면, 일반적으로 Monolithic Architecture 에선   
    한쪽에서 장애가 발생하면, 관련 서비스가 함께 모두 장애가 전파된다.   
    하지만 느슨한 결합 구조인 MSA 에선, 키오스크 / 주방 간에 서비스가   
    분리 되어 있기 때문에, 한쪽에서 장애가 일어날 경우 다른 한쪽에선   
    장애 여부를 알 수 없고, 자신의 일에 지장 받지 않는다.

### 그래서 잡다한 서론은 그만하고, MSA 장단점이 뭐야?
- 장점
  1. 각 서비스별로 배포 할 수 있다.
  2. 확장하기 쉬운 구조를 가진다.(키오스크 10대로 늘리는 상황처럼)
  3. 장애에 부분적 대응하기 수월하다.(주방이 마비 될 때, 주방만 서비스를 차단.)
- 단점
  1. 설계하기 까다롭다.(예를 들어 트랜잭션 처리와 같은 부분.)
  2. 각 서비스간 연계 되는 부분을 테스트하기 까다롭다.